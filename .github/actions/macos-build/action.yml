name: "Macos Build"
description: "Builds an Zip for Macos using Flutter."
inputs:
  token:
    description: "GitHub Token"
    required: true
  ref-name:
    description: "GitHub Ref Name"
    required: true
runs:
  using: "composite"
  steps:
    - name: Enable macOS build
      shell: bash
      run: flutter config --enable-macos-desktop

    - name: Build artifacts
      shell: bash
      run: flutter build macos --release
    
    - name: List build directory contents
      shell: bash
      run: ls -R build/macos/Build/Products/Release

    - name: Upload macOS app artifact
      uses: actions/upload-artifact@v3
      with:
        name: macos-app
        path: build/macos/Build/Products/Release/dohc_bible_ppt.app

    - uses: actions/checkout@v4
    - name: Use Node.js 18
      uses: actions/setup-node@v4
      with:
        node-version: 18
    - name: npm install -g appdmg
      shell: bash
      run: npm install -g appdmg
    
    - name: Build dmg
      shell: bash
      run: appdmg installers/dmg_creator/config.json installers/dmg_creator/dohc_bible_ppt.dmg

    - name: Archive Release
      uses: thedoctor0/zip-release@master
      with:
        type: 'zip'
        filename: dohc_bible_ppt_macos.dmg.zip
        directory: installers/dmg_creator
          
    - name: macOS Release
      uses: softprops/action-gh-release@v2
      if: startsWith(github.ref, 'refs/tags/')
      env:
          GITHUB_TOKEN: ${{ inputs.token }}
      with:
        files: installers/dmg_creator/dohc_bible_ppt.dmg.zip